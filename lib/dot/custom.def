{{
  var $schema = it.schema[$rule.keyword]
    , $ruleValidate = it.useCustomRule($rule, $schema, it.schema)
    , $ruleErrs = $ruleValidate.code + '.errors'
    , $schemaPath = it.schemaPath + '.' + $rule.keyword;
}}
{{=$ruleErrs}} = null;

{{## def.callRuleValidate:
  {{ var argsLen; }}
  {{=$ruleValidate.code}}.call(self
    {{? !$ruleValidate.compiled }}
      , validate.schema{{=$schemaPath}}
      , {{=$data}}
      {{? $ruleValidate.validate.length > 2 }}
        , validate.schema{{=it.schemaPath}}
      {{?}}
    {{??}}
      , {{=$data}}
    {{?}}
  )
#}}

  if (!{{# def.callRuleValidate }}) {
    if (Array.isArray({{=$ruleErrs}})) {
      if (vErrors === null) vErrors = {{=$ruleErrs}};
      else vErrors.concat({{=$ruleErrs}});
      errors = vErrors.length;
    } else {
      {{# def.error:'custom' }}
    }
{{? $breakOnError }}
    return false;
  } else {
{{??}}
  }
{{?}}
