{"name":"Ajv","tagline":"The fastest JSON Schema Validator","body":"# ajv - Another JSON Schema Validator\r\n\r\nCurrently the fastest JSON Schema validator for node.js and browser.\r\n\r\nIt uses [doT templates](https://github.com/olado/doT) to generate super-fast validating functions.\r\n\r\n[![Build Status](https://travis-ci.org/epoberezkin/ajv.svg?branch=master)](https://travis-ci.org/epoberezkin/ajv)\r\n[![npm version](https://badge.fury.io/js/ajv.svg)](http://badge.fury.io/js/ajv)\r\n[![Code Climate](https://codeclimate.com/github/epoberezkin/ajv/badges/gpa.svg)](https://codeclimate.com/github/epoberezkin/ajv)\r\n[![Test Coverage](https://codeclimate.com/github/epoberezkin/ajv/badges/coverage.svg)](https://codeclimate.com/github/epoberezkin/ajv/coverage)\r\n\r\n\r\n## JSON Schema standard\r\n\r\najv implements full [JSON Schema draft 4](http://json-schema.org/) standard:\r\n\r\n- all validation keywords (see [JSON-Schema validation keywords](https://github.com/epoberezkin/ajv/blob/master/KEYWORDS.md))\r\n- full support of remote refs (remote schemas have to be added with `addSchema` or compiled to be available)\r\n- asynchronous loading of referenced schemas during compilation.\r\n- support of circular dependencies between schemas\r\n- correct string lengths for strings with unicode pairs (can be turned off)\r\n- formats defined by JSON Schema draft 4 standard and custom formats (can be turned off)\r\n\r\nCurrently ajv is the only validator that passes all the tests from [JSON Schema Test Suite](https://github.com/json-schema/JSON-Schema-Test-Suite) (according to [json-schema-benchmark](https://github.com/ebdrup/json-schema-benchmark), apart from the test that requires that `1.0` is not an integer that is impossible to satisfy in JavaScript).\r\n\r\n\r\n## Performance\r\n\r\najv generates code to turn JSON schemas into javascript functions that are efficient for v8 optimization.\r\n\r\nCurrently ajv is the fastest validator according to these benchmarks:\r\n\r\n- [json-schema-benchmark](https://github.com/ebdrup/json-schema-benchmark) - 70% faster than the second place\r\n- [jsck benchmark](https://github.com/pandastrike/jsck#benchmarks) - 20-190% faster\r\n- [z-schema benchmark](https://rawgit.com/zaggino/z-schema/master/benchmark/results.html)\r\n- [themis benchmark](https://cdn.rawgit.com/playlyfe/themis/master/benchmark/results.html)\r\n\r\n\r\n## Install\r\n\r\n```\r\nnpm install ajv\r\n```\r\n\r\n\r\n## Usage\r\n\r\nTry it in the node REPL: https://tonicdev.com/npm/ajv\r\n\r\n\r\nThe fastest validation call:\r\n\r\n```\r\nvar Ajv = require('ajv');\r\nvar ajv = Ajv(); // options can be passed\r\nvar validate = ajv.compile(schema);\r\nvar valid = validate(data);\r\nif (!valid) console.log(validate.errors);\r\n```\r\n\r\nor with less code\r\n\r\n```\r\n// ...\r\nvar valid = ajv.validate(schema, data);\r\nif (!valid) console.log(ajv.errors);\r\n// ...\r\n```\r\n\r\nor\r\n\r\n```\r\n// ...\r\najv.addSchema(schema, 'mySchema');\r\nvar valid = ajv.validate('mySchema', data);\r\nif (!valid) console.log(ajv.errorsText());\r\n// ...\r\n```\r\n\r\najv compiles schemas to functions and caches them in all cases (using stringified schema as a key - using [json-stable-stringify](https://github.com/substack/json-stable-stringify)), so that the next time the same schema is used (not necessarily the same object instance) it won't be compiled again.\r\n\r\nThe best performance is achieved when using compiled functions returned by `compile` or `getSchema` methods (there is no additional function call).\r\n\r\n__Please note__: every time validation function or `ajv.validate` are called `errors` property is overwritten. You need to copy `errors` array reference to another variable if you want to use it later (e.g., in the callback).\r\n\r\n\r\n## Using in browser\r\n\r\nYou can require ajv directly from the code you browserify - in this case ajv will be a part of your bundle.\r\n\r\nIf you need to use ajv in several bundles you can create a separate browserified bundle using `bin/create-bundle` script (thanks to [siddo420](https://github.com/siddo420)).\r\n\r\nThen you need to load ajv in the browser:\r\n```\r\n<script src=\"ajv.bundle.js\"></script>\r\n```\r\n\r\nNow you can use it as shown above - `require` will be global and you can `require('ajv')`.\r\n\r\nAjv was tested with these browsers:\r\n\r\n[![Sauce Test Status](https://saucelabs.com/browser-matrix/epoberezkin.svg)](https://saucelabs.com/u/epoberezkin)\r\n\r\n\r\n## Formats\r\n\r\nThe following formats are supported for string validation with \"format\" keyword:\r\n\r\n- _date_: full-date from http://tools.ietf.org/html/rfc3339#section-5.6\r\n- _date-time_: date-time from the same source. Both `date` and `date-time` validate ranges in `full` mode and only regexp in `fast` mode (see [options](#options)).\r\n- _uri_: full uri with optional protocol.\r\n- _email_: email address.\r\n- _hostname_: host name acording to http://tools.ietf.org/html/rfc1034#section-3.5\r\n- _ipv4_: IP address v4.\r\n- _ipv6_: IP address v6.\r\n- _regex_: tests whether a string is a valid regular expression by passing it to RegExp constructor.\r\n\r\nThere are two modes of format validation: `fast` and `full` that affect all formats but `ipv4` and `ipv6`. See [Options](#options) for details.\r\n\r\nYou can add additional formats and replace any of the formats above using [addFormat](#api-addformat) method.\r\n\r\nYou can find patterns used for format validation and the sources that were used in [formats.js](https://github.com/epoberezkin/ajv/blob/master/lib/compile/formats.js).\r\n\r\n\r\n## Asynchronous compilation\r\n\r\nStarting from  version 1.3 ajv supports asynchronous compilation when remote references are loaded using supplied function. See `compileAsync` method and `loadSchema` option.\r\n\r\nExample:\r\n\r\n```\r\nvar ajv = Ajv({ loadSchema: loadSchema });\r\n\r\najv.compileAsync(schema, function (err, validate) {\r\n\tif (err) return;\r\n\tvar valid = validate(data);\r\n});\r\n\r\nfunction loadSchema(uri, callback) {\r\n\trequest.json(uri, function(err, res, body) {\r\n\t\tif (err || res.statusCode >= 400)\r\n\t\t\tcallback(err || new Error('Loading error: ' + res.statusCode));\r\n\t\telse\r\n\t\t\tcallback(null, body);\r\n\t});\r\n}\r\n```\r\n\r\n\r\n## Filtering data\r\n\r\nWith [option `removeAdditional`](#options) (added by [andyscott](https://github.com/andyscott)) you can filter data during the validation.\r\n\r\nThis option modifies original object.\r\n\r\n\r\n## API\r\n\r\n##### Ajv(Object options) -&gt; Object\r\n\r\nCreate ajv instance.\r\n\r\nAll the instance methods below are bound to the instance, so they can be used without the instance.\r\n\r\n\r\n##### .compile(Object schema) -&gt; Function&lt;Object data&gt;\r\n\r\nGenerate validating function and cache the compiled schema for future use.\r\n\r\nValidating function returns boolean and has properties `errors` with the errors from the last validation (`null` if there were no errors) and `schema` with the reference to the original schema.\r\n\r\nUnless the option `validateSchema` is false, the schema will be validated against meta-schema and if schema is invalid the error will be thrown. See [options](#options).\r\n\r\n\r\n##### .compileAsync(Object schema, Function callback)\r\n\r\nAsyncronous version of `compile` method that loads missing remote schemas using asynchronous function in `options.loadSchema`. Callback will always be called with 2 parameters: error (or null) and validating function. Error will be not null in the following cases:\r\n\r\n- missing schema can't be loaded (`loadSchema` calls callback with error).\r\n- the schema containing missing reference is loaded, but the reference cannot be resolved.\r\n- schema (or some referenced schema) is invalid.\r\n\r\nThe function compiles schema and loads the first missing schema multiple times, until all missing schemas are loaded.\r\n\r\nSee example in Asynchronous compilation.\r\n\r\n\r\n##### .validate(Object schema|String key|String ref, data) -&gt; Boolean\r\n\r\nValidate data using passed schema (it will be compiled and cached).\r\n\r\nInstead of the schema you can use the key that was previously passed to `addSchema`, the schema id if it was present in the schema or any previously resolved reference.\r\n\r\nValidation errors will be available in the `errors` property of ajv instance (`null` if there were no errors).\r\n\r\n__Please note__: every time this method is called the errors are overwritten so you need to copy them to another variable if you want to use them later.\r\n\r\n\r\n##### .addSchema(Array&lt;Object&gt;|Object schema [, String key])\r\n\r\nAdd schema(s) to validator instance. From version 1.0.0 this method does not compile schemas (but it still validates them). Because of that change, dependencies can be added in any order and circular dependencies are supported. It also prevents unnecessary compilation of schemas that are containers for other schemas but not used as a whole.\r\n\r\nArray of schemas can be passed (schemas should have ids), the second parameter will be ignored.\r\n\r\nKey can be passed that can be used to reference the schema and will be used as the schema id if there is no id inside the schema. If the key is not passed, the schema id will be used as the key.\r\n\r\n\r\nOnce the schema is added, it (and all the references inside it) can be referenced in other schemas and used to validate data.\r\n\r\nAlthough `addSchema` does not compile schemas, explicit compilation is not required - the schema will be compiled when it is used first time.\r\n\r\nBy default the schema is validated against meta-schema before it is added, and if the schema does not pass validation the exception is thrown. This behaviour is controlled by `validateSchema` option.\r\n\r\n\r\n##### .addMetaSchema(Object schema [, String key])\r\n\r\nAdds meta schema that can be used to validate other schemas. That function should be used instead of `addSchema` because there may be instance options that would compile a meta schema incorrectly (at the moment it is `removeAdditional` option).\r\n\r\nThere is no need to explicitly add draft 4 meta schema (http://json-schema.org/draft-04/schema and http://json-schema.org/schema) - it is added by default, unless option `meta` is set to `false`. You only need to use it if you have a changed meta-schema that you want to use to validate your schemas. See `validateSchema`.\r\n\r\n\r\n##### .validateSchema(Object schema) -&gt; Boolean\r\n\r\nValidates schema. This method should be used to validate schemas rather than `validate` due to the inconsistency of `uri` format in JSON-Schema standart.\r\n\r\nBy default this method is called automatically when the schema is added, so you rarely need to use it directly.\r\n\r\nIf schema doesn't have `$schema` property it is validated against draft 4 meta-schema (option `meta` should not be false).\r\n\r\nIf schema has `$schema` property then the schema with this id (should be previously added) is used to validate passed schema.\r\n\r\nErrors will be available at `ajv.errors`.\r\n\r\n\r\n##### .getSchema(String key) -&gt; Function&lt;Object data&gt;\r\n\r\nRetrieve compiled schema previously added with `addSchema` by the key passed to `addSchema` or by its full reference (id). Returned validating function has `schema` property with the reference to the original schema.\r\n\r\n\r\n##### .removeSchema(Object schema|String key|String ref)\r\n\r\nRemove added/cached schema. Even if schema is referenced by other schemas it can be safely removed as dependent schemas have local references.\r\n\r\nSchema can be removed using key passed to `addSchema`, it's full reference (id) or using actual schema object that will be stable-stringified to remove schema from cache.\r\n\r\n\r\n##### <a name=\"api-addformat\"></a>.addFormat(String name, String|RegExp|Function format)\r\n\r\nAdd custom format to validate strings. It can also be used to replace pre-defined formats for ajv instance.\r\n\r\nStrings are converted to RegExp.\r\n\r\nFunction should return validation result as `true` or `false`.\r\n\r\nCustom formats can be also added via `formats` option.\r\n\r\n\r\n##### .errorsText([Array&lt;Object&gt; errors [, Object options]]) -&gt; String\r\n\r\nReturns the text with all errors in a String.\r\n\r\nOptions can have properties `separator` (string used to separate errors, \", \" by default) and `dataVar` (the variable name that dataPaths are prefixed with, \"data\" by default).\r\n\r\n\r\n## Options\r\n\r\nDefaults:\r\n\r\n```\r\n{\r\n  allErrors:        false,\r\n  removeAdditional: false,\r\n  verbose:          false,\r\n  format:           'fast',\r\n  formats:          {},\r\n  schemas:          {},\r\n  meta:             true,\r\n  validateSchema:   true,\r\n  inlineRefs:       true,\r\n  missingRefs:      true,\r\n  loadSchema:       function(uri, cb) { /* ... */ cb(err, schema); },\r\n  uniqueItems:      true,\r\n  unicode:          true,\r\n  beautify:         false,\r\n  cache:            new Cache,\r\n  jsonPointers:     false,\r\n  i18n:             false,\r\n  messages:         true\r\n}\r\n```\r\n\r\n- _allErrors_: check all rules collecting all errors. Default is to return after the first error.\r\n- _removeAdditional_: remove additional properties. Default is not to remove. If the option is 'all', then all additional properties are removed, regardless of `additionalProperties` keyword in schema (and no validation is made for them). If the option is `true` (or truthy), only additional properties with `additionalProperties` keyword equal to `false` are removed. If the option is 'failing', then additional properties that fail schema validation will be removed too (where `additionalProperties` keyword is schema).\r\n- _verbose_: include the reference to the part of the schema and validated data in errors (false by default).\r\n- _format_: formats validation mode ('fast' by default). Pass 'full' for more correct and slow validation or `false` not to validate formats at all. E.g., 25:00:00 and 2015/14/33 will be invalid time and date in 'full' mode but it will be valid in 'fast' mode.\r\n- _formats_: an object with custom formats. Keys and values will be passed to `addFormat` method.\r\n- _schemas_: an array or object of schemas that will be added to the instance. If the order is important, pass array. In this case schemas must have IDs in them. Otherwise the object can be passed - `addSchema(value, key)` will be called for each schema in this object.\r\n- _meta_: add [meta-schema](http://json-schema.org/documentation.html) so it can be used by other schemas (true by default).\r\n- _validateSchema_: validate added/compiled schemas against meta-schema (true by default). `$schema` property in the schema can either be http://json-schema.org/schema or http://json-schema.org/draft-04/schema or absent (draft-4 meta-schema will be used) or can be a reference to the schema previously added with `addMetaSchema` method. If the validation fails, the exception is thrown. Pass \"log\" in this option to log error instead of throwing exception. Pass `false` to skip schema validation.\r\n- _inlineRefs_: by default the referenced schemas that don't have refs in them are inlined, regardless of their size - that substantially improves performance at the cost of the bigger size of compiled schema functions. Pass `false` to not inline referenced schemas (they will be compiled as separate functions). Pass integer number to limit the maximum number of keywords of the schema that will be inlined.\r\n- _missingRefs_: by default if the reference cannot be resolved during compilation the exception is thrown. The thrown error has properties `missingRef` (with hash fragment) and `missingSchema` (without it). Both properties are resolved relative to the current base id (usually schema id, unless it was substituted). Pass 'ignore' to log error during compilation and pass validation. Pass 'fail' to log error and successfully compile schema but fail validation if this rule is checked.\r\n- _loadSchema_: asynchronous function that will be used to load remote schemas when the method `compileAsync` is used and some reference is missing (option `missingRefs` should not be 'fail' or 'ignore'). This function should accept 2 parameters: remote schema uri and node-style callback. See example in Asynchronous compilation.\r\n- _uniqueItems_: validate `uniqueItems` keyword (true by default).\r\n- _unicode_: calculate correct length of strings with unicode pairs (true by default). Pass `false` to use `.length` of strings that is faster, but gives \"incorrect\" lengths of strings with unicode pairs - each unicode pair is counted as two characters.\r\n- _beautify_: format the generated function with [js-beautify](https://github.com/beautify-web/js-beautify) (the validating function is generated without line-breaks). `npm install js-beautify` to use this option. `true` or js-beautify options can be passed.\r\n- _cache_: an optional instance of cache to store compiled schemas using stable-stringified schema as a key. For example, set-associative cache [sacjs](https://github.com/epoberezkin/sacjs) can be used. If not passed then a simple hash is used which is good enough for the common use case (a limited number of statically defined schemas). Cache should have methods `put(key, value)`, `get(key)` and `del(key)`.\r\n- _jsonPointers_: Output `dataPath` using JSON Pointers instead of JS path notation.\r\n- _i18n_: Support internationalization of error messages using [ajv-i18n](https://github.com/epoberezkin/ajv-i18n). See its repo for details.\r\n- _messages_: Include human-readable messages in errors. `true` by default. `messages: false` can be added when internationalization (options `i18n`) is used.\r\n\r\n\r\n## Command line interface\r\n\r\nSimple JSON-schema validation can be done from command line using [ajv-cli](https://github.com/jessedc/ajv-cli) package. At the moment it does not support referenced schemas.\r\n\r\n\r\n## Tests\r\n\r\n```\r\nnpm install\r\ngit submodule update --init\r\nnpm test\r\n```\r\n\r\n## Contributing\r\n\r\nAll validation functions are generated using doT templates in [dot](https://github.com/epoberezkin/ajv/tree/master/lib/dot) folder. Templates are precompiled so doT is not a run-time dependency.\r\n\r\n`npm run build` - compiles templates to [dotjs](https://github.com/epoberezkin/ajv/tree/master/lib/dotjs) folder.\r\n\r\n`npm run watch` - automatically compiles templates when files in dot folder change\r\n\r\n\r\n## Changes history\r\n\r\nSee https://github.com/epoberezkin/ajv/releases\r\n\r\n\r\n## License\r\n\r\n[MIT](https://github.com/epoberezkin/ajv/blob/master/LICENSE)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}